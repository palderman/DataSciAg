---
title: "Wrangling Data - Joining Datasets"
author: |
  | Data Science for Agriculture and Natural Resources
  | PLNT 5413 - Fall `r format(Sys.Date(),'%Y')`
output: pdf_document
link-citations: true
urlcolor: blue
margin: 1in
fontsize: 12pt
geometry: "left=1in,right=1in,top=1in,bottom=1.25in"
header-includes:
- \usepackage{titling}
- \usepackage{lastpage}
- \usepackage{fancyhdr}
- \newcommand{\aspace}[1]{\vspace{#1\baselineskip}}
- \renewcommand{\headrulewidth}{0pt}
- \fancypagestyle{plain}{ \fancyhf{} \fancyfoot[C]{\aspace{2}Page \thepage~of~\pageref{LastPage}} }
- \pagestyle{fancy}
- \fancyhf{}
- \fancyfoot[C]{\small \thetitle \\ Data Science for Agriculture and Natural Resources\\PLNT 5413 - Fall `r format(Sys.Date(),'%Y')`\\ Page \thepage~of~\pageref{LastPage}}
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)

tree_raw <- read_tsv('data/Macroplot_data_Rev.txt')

tree_genus <- tree_raw %>%  pivot_longer(TreeGirth1:TreeGirth5,names_to='stem',values_to='girth') %>%
  filter(girth>0) %>% 
  mutate(diameter = girth/pi,
         tree_mass = 0.124*diameter^2.53) %>% 
  separate(SpCode,
           into=c("GenusCode", "SpEpCode"), sep=4)
```

This assignment builds on the results of the `Pivoting and Mutating Data` assignment. Import and tidy the [raw data](https://canvas.okstate.edu/courses/109158/files/12019188) for the 96 hectare area of the Western Ghats in India as you did in the previous assignments.

1. We are also interested in the impact of location on tree girth. Import the [Site Variables table](https://canvas.okstate.edu/courses/109158/files/12019189) and join it with the cleaned dataset from the `Pivoting and Mutating Data` assignment.

```{r prob1}
joined <- read_tsv('data/Site_variables.txt') %>%  
  right_join(tree_genus,by='PlotID')
joined
```

2. Generate a boxplot of girth vs forest division. The number of extreme points makes it difficult to see the shape of the boxes so limit the y-axis from 0 to 200.

```{r prob2}
joined %>% 
ggplot(aes(x=ForestDiv,y=girth))+
  geom_boxplot()+
  coord_cartesian(ylim=c(0,200))
```

3. Regenerate the boxplot from problem 2 with the forest divisions ordered by latitude. This will involve converting the forest division to a factor and reordering the factor levels based on the average latitude for each division.

```{r prob3}
joined %>% 
mutate(ForestDiv=factor(ForestDiv)) %>%
  mutate(ForestDiv=fct_reorder(ForestDiv, LatDec, mean)) %>%
  ggplot(aes(x=ForestDiv,y=girth))+
  geom_boxplot()+
  coord_cartesian(ylim=c(0,200))
```