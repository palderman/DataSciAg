---
title: "Wrangling Data - Manipulating Data"
author: |
  | Data Science for Agriculture and Natural Resources
  | PLNT 5413 - Fall `r format(Sys.Date(),'%Y')`
output: pdf_document
link-citations: true
urlcolor: blue
margin: 1in
fontsize: 12pt
geometry: "left=1in,right=1in,top=1in,bottom=1.25in"
header-includes:
- \usepackage{titling}
- \usepackage{lastpage}
- \usepackage{fancyhdr}
- \newcommand{\aspace}[1]{\vspace{#1\baselineskip}}
- \renewcommand{\headrulewidth}{0pt}
- \fancypagestyle{plain}{ \fancyhf{} \fancyfoot[C]{\aspace{2}Page \thepage~of~\pageref{LastPage}} }
- \pagestyle{fancy}
- \fancyhf{}
- \fancyfoot[C]{\small \thetitle \\ Data Science for Agriculture and Natural Resources\\PLNT 5413 - Fall `r format(Sys.Date(),'%Y')`\\ Page \thepage~of~\pageref{LastPage}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
# Raw data import
tree_raw <- read_tsv('data/Macroplot_data_Rev.txt')
```

You previously worked on reading metadata and importing raw data in the `Metadata and Data Import` assignment. In this assignment we will build on that to manipulate the [raw data](https://canvas.okstate.edu/courses/109158/files/12019188) you have already imported.

There are lots of equations for estimating the mass of a tree from its diameter, but one good option is the equation: $$ Mass = 0.124 * Diameter^{2.53}$$ where $Mass$ is measured in kg of dry above-ground biomass and $Diameter$ is in cm [DBH](https://en.wikipedia.org/wiki/Diameter_at_breast_height) ([Brown 1997](http://www.fao.org/docrep/W4095E/W4095E00.htm)).

1. Begin by importing the raw data. Then use `pivot_longer()` to convert the raw data into rows for each measured stem. (Note: In the metadata for TreeGirth2 to TreeGirth5 it states "value of 0 indicates that the stem doesn't exist" so you will need to filter out these rows once you have gathered the data.)

```{r prob1}

tree_gathered <- tree_raw %>%  pivot_longer(TreeGirth1:TreeGirth5,names_to='stem',values_to='girth') %>%
  filter(girth>0)
tree_gathered

```

2. Create a new column by converting girth (i.e. circumference) to stem diameter (recall that circumference = pi * diameter).

```{r prob2}
tree_diameter <- mutate(tree_gathered,
                        diameter=girth/pi)
tree_diameter
```

3. Create a new column that contains estimates of the tree mass by using the diameter and the equation above. Print the result to the screen.

```{r prob3}
tree_biomass <- mutate(tree_diameter,
                       tree_mass=0.124*diameter^2.53)
tree_biomass
```

4. `separate()` the `SpCode` into `GenusCode` and `SpEpCode`. Technically the four letter code doesn’t uniquely identify all of the genera in the dataset, but we’ll assume it does for the purpose of this exercise.

```{r prob4}
tree_genus <- separate(tree_biomass,
                       SpCode,
                       into=c("GenusCode","SpEpCode"),
                       sep=4)
tree_genus
```


5. Calculate the mean biomass for each genus.

```{r prob5}
tree_genus %>% group_by(GenusCode) %>% summarize(avg_mass=mean(tree_mass,na.rm=TRUE))
```